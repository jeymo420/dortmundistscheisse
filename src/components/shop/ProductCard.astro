---
import type { ImageMetadata } from "astro";
import { Image } from "astro:assets";
import type { Product } from "@/types/Product";

const { url, title, subtitle, price, image } = Astro.props as Product;

const images = import.meta.glob<{ default: ImageMetadata }>(
	"/src/assets/images/*.{jpeg,jpg,png,gif}"
);

const imagesByName: Record<string, () => Promise<{ default: ImageMetadata }>> =
	{};
for (const path in images) {
	const parts = path.split("/");
	const filename = parts[parts.length - 1];
	imagesByName[filename] = images[path];
}

if (!imagesByName[image])
	throw new Error(
		`"${image}" does not exist in glob: "src/assets/images/*.{jpeg,jpg,png,gif}"`
	);
---

<a href={`/product/${url}`} class="group block">
	<Image
		src={imagesByName[image]()}
		alt="test"
		class="h-80 w-full object-cover sm:h-100 aspect-12/9 group-hover:scale-105 transition-all"
		height="600"
		width="700"
	/>

	<div class="mt-3 flex justify-between text-sm">
		<div>
			<h3
				class="text-gray-900 group-hover:underline group-hover:underline-offset-4 group-hover:text-bochumb">
				{title}
			</h3>

			<p class="mt-1.5 text-xs text-pretty text-gray-500">
				{subtitle}
			</p>
		</div>

		<p class="text-bochumb">{price.toFixed(2)}â‚¬</p>
	</div>
</a>
