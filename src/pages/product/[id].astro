---
import StoreLayout from "@/layouts/StoreLayout.astro";
import { Image } from "astro:assets";
import { getEntry } from "astro:content";

const product = await getEntry("products", Astro.params.id);

if (!product) {
	return Astro.rewrite("/");
}

const images = import.meta.glob<{ default: string }>(
	"/src/assets/images/*.{jpeg,jpg,png,gif}"
);
const imageImport = images[`/src/assets/images/${product.data.image}`];

if (!imageImport) {
	throw new Error(
		`Image "${product.data.image}" not found in /src/assets/images`
	);
}

const image = (await imageImport()).default;
---

<StoreLayout>
	<section class="max-w-7xl mx-auto py-12 px-4">
		<div
			class="grid items-start grid-cols-1 lg:grid-cols-2 gap-8 max-lg:gap-12 max-sm:gap-8">
			<div class="w-full lg:sticky top-0">
				<div class="flex flex-row gap-2">
					<div class="flex flex-col gap-2 w-16 max-sm:w-14 shrink-0">
						<Image
							src={image}
							alt={product.data.title}
							class="aspect-64/85 object-cover object-top w-full cursor-pointer border-b-2 border-black"
							width="200"
							height="200"
						/>
					</div>
					<div class="flex-1">
						<Image
							src={image}
							alt={product.data.title}
							class="w-full aspect-[548/712] object-cover"
							width="600"
							height="600"
						/>
					</div>
				</div>
			</div>

			<div class="w-full">
				<div>
					<h3 class="text-lg sm:text-xl font-semibold text-bochumb">
						{product.data.title}
					</h3>
					<p class="text-slate-500 mt-2 text-sm">
						{product.data.subtitle}
					</p>
					<div class="flex items-center flex-wrap gap-4 mt-6">
						<h4
							class="text-bochumb text-2xl sm:text-3xl font-semibold">
							{product.data.price.toFixed(2)}€
						</h4>
						<p class="text-slate-500 text-lg">
							<strike>
								{(product.data.price + 3).toFixed(2)}€
							</strike>
							<span class="text-sm ml-1.5">zzgl. Versand </span>
						</p>
					</div>
				</div>

				<hr class="my-6 border-slate-300" />

				<div>
					<h3 class="text-lg sm:text-xl font-semibold text-slate-900">
						Mengen
					</h3>
					<div
						class="flex flex-wrap gap-4 mt-4"
						id="quantity-buttons">
						<button data-qty="50" class="qty-btn">50</button>
						<button data-qty="100" class="qty-btn border-bochumb"
							>100</button
						>
						<button data-qty="150" class="qty-btn">150</button>
						<button data-qty="200" class="qty-btn">200</button>
						<button
							id="custom-btn"
							class="h-9 border border-slate-300 hover:border-bochumb text-sm cursor-pointer flex items-center justify-center shrink-0 px-2"
							>Individuell</button
						>
					</div>

					<div id="custom-qty" class="mt-4 hidden max-w-xs">
						<input
							type="number"
							step="10"
							min="10"
							value="100"
							class="w-full border px-3 py-2 text-sm"
						/>
					</div>

					<div class="mt-6 flex flex-wrap gap-4">
						<button
							type="button"
							id="add-to-cart"
							class="px-4 py-3 w-[45%] cursor-pointer border border-bochumb bg-bochumb hover:bg-logodb text-white text-sm font-medium">
							In den Warenkorb
						</button>
					</div>
				</div>

				<hr class="my-6 border-slate-300" />

				<!-- <div>
                    <h3
                        class="text-lg sm:text-xl font-semibold text-slate-900">
                        Eigener Text
                    </h3>
                    <p class="text-slate-500 text-sm mt-2">
                        Füge deinem Produkt einen individuellen Text
                        hinzu!
                    </p>
                    <div class="flex items-center gap-2 mt-6 max-w-sm">
                        <input
                            type="text"
                            placeholder="Dein Text hier"
                            class="bg-slate-100 px-4 py-2.5 text-sm w-full border-0 outline-0"
                        />
                        <button
                            type="button"
                            class="border-0 outline-0 bg-bochumb hover:bg-logodb text-white cursor-pointer px-4 py-2.5 text-sm"
                            >Speichern</button
                        >
                    </div>
                </div>

                <hr class="my-6 border-slate-300" /> -->

				<div>
					<h3 class="text-lg sm:text-xl font-semibold text-slate-900">
						Produkt Informationen
					</h3>
					<div class="mt-4">
						<div class="hover:bg-slate-100 transition-all">
							<button
								data-accordion-btn
								type="button"
								class="w-full text-sm font-semibold cursor-pointer text-left px-4 py-2.5 text-slate-900 flex items-center">
								<span class="mr-4">Produkt details</span>
								<svg
									xmlns="http://www.w3.org/2000/svg"
									class="w-3 h-3 fill-current ml-auto shrink-0 -rotate-180"
									viewBox="0 0 24 24">
									<path
										fill-rule="evenodd"
										d="M11.99997 18.1669a2.38 2.38 0 0 1-1.68266-.69733l-9.52-9.52a2.38 2.38 0 1 1 3.36532-3.36532l7.83734 7.83734 7.83734-7.83734a2.38 2.38 0 1 1 3.36532 3.36532l-9.52 9.52a2.38 2.38 0 0 1-1.68266.69734z"
										clip-rule="evenodd"
										data-original="#000000"></path>
								</svg>
							</button>
							<div class="pb-4 px-4 data-accordion-content">
								<p
									class="text-sm text-slate-500 leading-relaxed">
									Hochwertige Indoor-Aufkleber mit freier
									Größe <br />
									(rechteckig) bis 30 x 150 cm 4/0-farbig (einseitig
									bedruckt) <br />
									Indoor: 80 g/m² Haftetikettenpapier weiß, einseitig
									hochglänzend gestrichen <br />
									Auflösung 300 dpi <br />
									Maximales Format: 30 x 150 cm
								</p>
							</div>
						</div>

						<div class="hover:bg-slate-100 transition-all">
							<button
								data-accordion-btn
								type="button"
								class="w-full text-sm font-semibold cursor-pointer text-left px-4 py-2.5 text-slate-900 flex items-center">
								<span class="mr-4">
									Wichtige Informationen zum Bestellvorgang
								</span>
								<svg
									xmlns="http://www.w3.org/2000/svg"
									class="w-3 h-3 fill-current ml-auto shrink-0 -rotate-90"
									viewBox="0 0 24 24">
									<path
										fill-rule="evenodd"
										d="M11.99997 18.1669a2.38 2.38 0 0 1-1.68266-.69733l-9.52-9.52a2.38 2.38 0 1 1 3.36532-3.36532l7.83734 7.83734 7.83734-7.83734a2.38 2.38 0 1 1 3.36532 3.36532l-9.52 9.52a2.38 2.38 0 0 1-1.68266.69734z"
										clip-rule="evenodd"
										data-original="#000000"></path>
								</svg>
							</button>
							<div
								class="pb-4 px-4 hidden data-accordion-content">
								<p
									class="text-sm text-slate-500 leading-relaxed">
									Zahlung ausschließlich per PayPal. <br />
									Versand innerhalb von 2–4 Werktagen nach Zahlungseingang.
									<br />
									Die Bestellung ist unverbindlich und dient zunächst
									als Anfrage. <br />
									Nach Prüfung und Bestätigung durch uns erfolgt
									die Zahlung durch den Kunden per PayPal. <br
									/>
									Die Ware wird nach Zahlungseingang bearbeitet
									und versendet.
								</p>
							</div>
						</div>

						<div class="hover:bg-slate-100 transition-all">
							<button
								data-accordion-btn
								type="button"
								class="w-full text-sm font-semibold cursor-pointer text-left px-4 py-2.5 text-slate-900 flex items-center">
								<span class="mr-4">
									Rückgabe &amp; Umtausch
								</span>
								<svg
									xmlns="http://www.w3.org/2000/svg"
									class="w-3 h-3 fill-current ml-auto shrink-0 -rotate-90"
									viewBox="0 0 24 24">
									<path
										fill-rule="evenodd"
										d="M11.99997 18.1669a2.38 2.38 0 0 1-1.68266-.69733l-9.52-9.52a2.38 2.38 0 1 1 3.36532-3.36532l7.83734 7.83734 7.83734-7.83734a2.38 2.38 0 1 1 3.36532 3.36532l-9.52 9.52a2.38 2.38 0 0 1-1.68266.69734z"
										clip-rule="evenodd"
										data-original="#000000"></path>
								</svg>
							</button>
							<div
								class="pb-4 px-4 hidden data-accordion-content">
								<p
									class="text-sm text-slate-500 leading-relaxed">
									Keine Rückgabe oder Umtausch. Bitte
									sicherstellen, dass die Bestellung korrekt
									ist vor dem Absenden.
								</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
</StoreLayout>
<script>
	document.querySelectorAll("[data-accordion-btn]").forEach((btn) => {
		btn.addEventListener("click", () => {
			const content = btn.nextElementSibling;
			const icon = btn.querySelector("svg");

			content.classList.toggle("hidden");
			icon.classList.toggle("-rotate-180");
			icon.classList.toggle("-rotate-90");
		});
	});
</script>
